# ğŸ  YooseAI Algarve - AI-Powered Agentic Housing Workflow

<div align="center">

**Transform your housing search from weeks of frustration into minutes of intelligent automation**

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-Latest-green.svg)](https://fastapi.tiangolo.com/)
[![Next.js](https://img.shields.io/badge/Next.js-16.0-black.svg)](https://nextjs.org/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

</div>

---

## ğŸŒŸ What is YooseAI Algarve?

**YooseAI Algarve** is not just a chatbot; it's a sophisticated, multi-agent AI workflow designed to automate and revolutionize the search for long-term rental housing in Portugal's Algarve region.

Users interact with the system using natural language, specifying their ideal home. Our autonomous agent workforce then scours the entire internet, identifies the best properties, enriches the data with geospatial intelligence, and asynchronously initiates negotiation calls to landlords to determine availability and the best possible price. The result is a curated, actionable list of the best housing options, complete with negotiation intelligenceâ€”all delivered in **Portuguese**.

### ğŸ¯ Key Differentiators

- ğŸ¤– **Multi-Agent Architecture**: Specialized AI agents work in harmony to accomplish complex tasks
- ğŸŒ **Internet-Wide Search**: Aggregates listings from all major Portuguese real estate portals
- ğŸ“ **Automated Negotiation**: AI-powered phone calls handle initial landlord conversations
- ğŸ‡µğŸ‡¹ **Portuguese-First**: Fully localized for the Algarve market
- ğŸ—ºï¸ **Geospatial Intelligence**: Maps, POIs, and neighborhood insights
- âš¡ **Asynchronous Processing**: Multiple properties researched and negotiated simultaneously

---

## ğŸ”„ Core Workflow: From Text to Tenancy

This platform transforms a simple text-based request into a comprehensive, pre-negotiated housing portfolio.

### Step-by-Step Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  "OlÃ¡, procuro um apartamento T2 em Faro perto da universidade, â”‚
â”‚   atÃ© 1000â‚¬. Tenho um cÃ£o pequeno."                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” Internet-Wide Search & Aggregation                          â”‚
â”‚  â€¢ Idealista, Imovirtual, Casa Sapo, OLX                        â”‚
â”‚  â€¢ Intelligent de-duplication                                   â”‚
â”‚  â€¢ Structured data extraction                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ Intelligent Selection & Enrichment                          â”‚
â”‚  â€¢ Compatibility scoring against user profile                   â”‚
â”‚  â€¢ Geocoded coordinates                                         â”‚
â”‚  â€¢ Local POIs (supermarkets, schools, transport)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Automated, Asynchronous Negotiation Calls                  â”‚
â”‚  â€¢ Pre-call intelligence gathering                              â”‚
â”‚  â€¢ AI-powered phone calls to landlords                          â”‚
â”‚  â€¢ Natural Portuguese conversations                             â”‚
â”‚  â€¢ Availability & price flexibility inquiries                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ¨ Curated, Actionable Results                                 â”‚
â”‚  â€¢ Best options with negotiation insights                      â”‚
â”‚  â€¢ Availability confirmations                                   â”‚
â”‚  â€¢ Price negotiation outcomes                                   â”‚
â”‚  â€¢ Ready-to-contact listings                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1ï¸âƒ£ Natural Language Input

A user simply describes what they're looking for in Portuguese:

> **Example**: *"OlÃ¡, procuro um apartamento T2 em Faro perto da universidade, atÃ© 1000â‚¬. Tenho um cÃ£o pequeno."*

The system understands:
- Property type (T2 apartment)
- Location (Faro, near university)
- Budget constraint (up to â‚¬1000)
- Special requirements (small dog allowed)

### 2ï¸âƒ£ Internet-Wide Search & Aggregation

The **Research Agent** is dispatched to query all major real estate portals:

- **Idealista** - Portugal's leading property portal
- **Imovirtual** - Comprehensive listing database
- **Casa Sapo** - Popular marketplace
- **OLX ImÃ³veis** - Classified ads platform

It gathers every potential match, intelligently de-duplicates listings using URL fingerprints and address normalization, and structures the raw data into a consistent format.

### 3ï¸âƒ£ Intelligent Selection & Enrichment

The system filters the aggregated list, scoring each property for compatibility against the user's profile. It enriches each valid listing with:

- **Geocoded coordinates** via Mapbox
- **Local points of interest** (POIs):
  - ğŸ« Schools and universities
  - ğŸ›’ Supermarkets and shopping
  - ğŸ¥ Healthcare facilities
  - ğŸšŒ Public transport stops
  - ğŸ–ï¸ Beaches and recreation
- **Negotiation scoring** based on market conditions

### 4ï¸âƒ£ Automated, Asynchronous Negotiation Calls

This is where **YooseAI Algarve** truly shines. The user can select their top properties, and the system initiates the VAPI Agent workflow:

1. **Prober Agent** gathers pre-call intelligence:
   - Time on market
   - Price history and reductions
   - Property characteristics
   - Market comparisons

2. **VAPI Agent** places asynchronous, AI-powered phone calls:
   - Converses naturally in Portuguese
   - Confirms availability
   - Inquires about price flexibility
   - Understands specific tenant requirements
   - Extracts key negotiation points

3. **LLM Analyzer** processes call transcripts:
   - Extracts availability status
   - Identifies negotiation opportunities
   - Summarizes landlord responses

### 5ï¸âƒ£ Curated, Actionable Results

The user is presented with a final, distilled list of the best options. Each listing is now augmented with:

- âœ… Availability confirmations
- ğŸ’° Price negotiation outcomes
- ğŸ“ Landlord response summaries
- ğŸ¯ Negotiation intelligence
- ğŸ“ Enriched location data

---

## ğŸ—ï¸ System Architecture: An Orchestra of Agents

YooseAI Algarve is built on a robust, microservices-inspired architecture where specialized AI agents collaborate to fulfill the user's goal. This multi-agent system is orchestrated by a central Coordinator and exposed via a FastAPI REST API.

### High-Level Agentic Workflow

#### Phase 1: Research & Enrichment

```
[User Defines Housing Need via Text]
    â†“ (Natural Language Request)
[FastAPI / Coordinator]
    â†“ (Parse & Structure)
[Scoping Agent - Understands the Query]
    â†“ (UserRequirements Schema)
[FastAPI / Coordinator]
    â†“ (Search Query)
[Research Agent - Searches the Internet]
    â†“ (HTTP Requests)
[Real Estate Portals: Idealista, Imovirtual, Casa Sapo, OLX]
    â†“ (Listing Data)
[Research Agent]
    â†“ (PropertyListings)
[FastAPI / Coordinator]
    â†“ (Enrichment Tasks)
[Enrichment Agents - Mapbox, POIs, Scoring]
    â†“ (API Calls)
[Mapping & Data APIs: Mapbox, Geocoding, POIs]
    â†“ (Geocoded Data & POIs)
[Enrichment Agents]
    â†“ (Enriched Listings)
[FastAPI / Coordinator]
```

#### Phase 2: Automated Negotiation (Asynchronous)

```
[FastAPI / Coordinator]
    â†“ (Selected Properties)
[Prober Agent - Gathers Negotiation Intel]
    â†“ (Web Research)
[Real Estate Portals]
    â†“ (Negotiation Intel)
[FastAPI / Coordinator]
    â†“ (Call Configuration)
[VAPI Agent - Places AI Phone Calls]
    â†“ (Phone Calls)
[Telephony Service: VAPI - AI Phone Calls]
    â†“ (Call Transcripts)
[VAPI Agent]
    â†“ (Analysis Request)
[LLM Analyzer - Extracts Call Outcomes]
    â†“ (Structured Outcomes)
[FastAPI / Coordinator]
    â†“ (Final Results)
[User Receives Curated List with Negotiation Insights]
```

#### Complete Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER INTERACTION                             â”‚
â”‚  [1. User Defines Housing Need via Text]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASTAPI / COORDINATOR                         â”‚
â”‚              (Orchestrates Agent Workflow)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 1: RESEARCH & ENRICHMENT                      â”‚
â”‚                                                                  â”‚
â”‚  [Scoping Agent] â†’ [Research Agent] â†’ [Enrichment Agents]      â”‚
â”‚  â€¢ Understands Query    â€¢ Searches Internet   â€¢ Mapbox, POIs   â”‚
â”‚  â€¢ Extracts Requirements â€¢ Aggregates Data      â€¢ Scoring        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL SYSTEMS                              â”‚
â”‚                                                                  â”‚
â”‚  [Real Estate Portals]      [Mapping APIs]                      â”‚
â”‚  â€¢ Idealista                 â€¢ Mapbox                            â”‚
â”‚  â€¢ Imovirtual                â€¢ Geocoding                         â”‚
â”‚  â€¢ Casa Sapo                 â€¢ POIs                              â”‚
â”‚  â€¢ OLX                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 2: AUTOMATED NEGOTIATION                      â”‚
â”‚                    (Asynchronous)                                â”‚
â”‚                                                                  â”‚
â”‚  [Prober Agent] â†’ [VAPI Agent] â†’ [LLM Analyzer]                 â”‚
â”‚  â€¢ Gathers Intel     â€¢ Places Calls     â€¢ Extracts Outcomes     â”‚
â”‚  â€¢ Market Research   â€¢ Negotiates Price  â€¢ Structures Results    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL SYSTEMS                              â”‚
â”‚                                                                  â”‚
â”‚  [Telephony Service: VAPI - AI Phone Calls]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER INTERACTION                              â”‚
â”‚  [8. Presents Curated List with Negotiation Insights]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent Roles & Responsibilities

Each agent is a specialized worker with a clear role in the assembly line:

#### ğŸ¯ Coordinator Agent (`main.py`)
The **project manager**. It receives requests from the API and directs tasks to the appropriate specialist agents, ensuring the workflow proceeds smoothly and results are aggregated correctly.

**Key Responsibilities:**
- Routes requests to appropriate agents
- Aggregates responses from multiple agents
- Manages session state
- Handles error recovery and fallbacks

#### ğŸ’¬ Scoping Agent (`scoping_agent.py`)
The **conversational specialist**. It interprets the user's natural language request and transforms it into a structured `UserRequirements` schema that other agents can act upon.

**Key Responsibilities:**
- Natural language understanding
- Extracts requirements: budget, location, bedrooms, amenities
- Handles follow-up questions
- Validates completeness of requirements

**Example Output:**
```python
UserRequirements(
    budget_min=800,
    budget_max=1000,
    bedrooms=2,
    location="Faro",
    additional_info="Near university, small dog allowed"
)
```

#### ğŸ” Research Agent (`research_agent.py`)
The **tireless data miner**. It queries multiple online sources, scrapes listing data using BrightData and Firecrawl, and cleans the results.

**Key Responsibilities:**
- Multi-source web scraping
- Data extraction and normalization
- De-duplication logic
- Quality filtering

**Supported Sources:**
- Idealista.pt
- Imovirtual.com
- Casasapo.pt
- OLX.pt

#### ğŸ•µï¸ Prober Agent (`prober_agent.py`)
The **private investigator**. Before a call is made, this agent scours the web for any information that could provide negotiation leverage.

**Key Responsibilities:**
- Price history research
- Time-on-market analysis
- Comparable property research
- Market condition assessment

**Example Findings:**
- Property listed for 3 months
- Price reduced by â‚¬50/month
- Similar properties in area priced lower
- High availability in neighborhood

#### ğŸ“ VAPI Agent (`vapi_agent.py`)
The **negotiator**. This agent uses the VAPI service to conduct AI-powered, human-like phone calls. It is dynamically configured with the property details and negotiation points from the Prober Agent to achieve its objectives.

**Key Responsibilities:**
- Initiates asynchronous phone calls
- Converses naturally in Portuguese
- Confirms availability
- Negotiates price flexibility
- Gathers tenant requirements

**Call Objectives:**
- âœ… Confirm property availability
- ğŸ’° Inquire about price flexibility
- ğŸ“… Understand move-in timeline
- ğŸ“‹ Clarify tenant requirements
- ğŸ  Gather property details

#### ğŸ—ºï¸ Mapbox Agent (`mapbox_agent.py`)
The **geospatial specialist**. Enriches property listings with precise coordinates and location intelligence.

**Key Responsibilities:**
- Geocoding addresses
- Reverse geocoding coordinates
- POI discovery
- Route calculations

#### ğŸ˜ï¸ Local Discovery Agent (`local_agent.py`)
The **neighborhood expert**. Discovers and analyzes local amenities and points of interest.

**Key Responsibilities:**
- Find nearby schools
- Locate supermarkets
- Identify public transport
- Map healthcare facilities

#### ğŸ‘¥ Community Analysis Agent (`community_agent.py`)
The **neighborhood analyst**. Provides insights about the local community and area characteristics.

**Key Responsibilities:**
- Demographic analysis
- Safety indicators
- Community amenities
- Area reputation

---

## ğŸ“Š Core Schemas: The Blueprint for Success

A reliable agentic workflow depends on structured, predictable data models. Our core schemas ensure that information flows consistently between agents, preventing errors and ensuring each agent has the context it needs to perform its task.

All data models are defined using **Pydantic** in `backend/models.py`.

### Key Schemas

#### `UserRequirements`
A structured representation of the user's needs.

```python
class UserRequirements(Model):
    budget_min: Optional[int] = None
    budget_max: Optional[int] = None
    bedrooms: Optional[int] = None
    bathrooms: Optional[float] = None
    location: str
    additional_info: Optional[str] = None
```

#### `PropertyListing`
A normalized model for a housing property, containing all enriched data.

```python
class PropertyListing(Model):
    address: Optional[str] = None
    city: Optional[str] = None
    price: Optional[int] = None
    bedrooms: Optional[int] = None
    bathrooms: Optional[int] = None
    latitude: Optional[float] = None
    longitude: Optional[float] = None
    negotiation_score: Optional[float] = None
    contact_phone: Optional[str] = None
    url: Optional[str] = None
    # ... and more
```

#### `ProberFinding`
A piece of actionable intelligence found by the Prober Agent.

```python
class ProberFinding(Model):
    finding_type: str  # e.g., "price_reduction", "time_on_market"
    description: str
    confidence: float
    source_url: Optional[str] = None
```

#### `VapiRequest` / `VapiResponse`
The data packets for initiating and reporting on automated phone calls.

```python
class VapiRequest(Model):
    property_address: str
    listing_url: str
    contact_phone: str
    user_name: str
    user_email: str
    prober_findings: List[ProberFinding]
    # ... call configuration

class VapiResponse(Model):
    call_id: str
    status: str
    transcript: Optional[str] = None
    availability: Optional[bool] = None
    price_flexibility: Optional[str] = None
    # ... call outcomes
```

---

## ğŸ“ Repository Structure

The project is organized to separate concerns, making it easy to navigate, maintain, and extend.

```
Algarve_Hack/
â”œâ”€â”€ backend/                          # Python backend - Agent orchestration
â”‚   â”œâ”€â”€ api.py                        # FastAPI server for the negotiation workflow
â”‚   â”œâ”€â”€ main.py                       # Main entry point with Coordinator Agent
â”‚   â”œâ”€â”€ models.py                     # Core Pydantic data models and schemas
â”‚   â”œâ”€â”€ llm_client.py                 # Shared client for interacting with LLMs
â”‚   â”œâ”€â”€ requirement.txt               # Python dependencies
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/                       # Specialized AI agents
â”‚   â”‚   â”œâ”€â”€ base_agent.py             # Base agent utilities
â”‚   â”‚   â”œâ”€â”€ scoping_agent.py          # Natural language understanding
â”‚   â”‚   â”œâ”€â”€ research_agent.py         # Web scraping and aggregation
â”‚   â”‚   â”œâ”€â”€ prober_agent.py           # Pre-call intelligence gathering
â”‚   â”‚   â”œâ”€â”€ vapi_agent.py             # AI phone call orchestration
â”‚   â”‚   â”œâ”€â”€ vapi_prompts.py           # Portuguese call prompts
â”‚   â”‚   â”œâ”€â”€ mapbox_agent.py           # Geocoding and mapping
â”‚   â”‚   â”œâ”€â”€ local_agent.py            # POI discovery
â”‚   â”‚   â””â”€â”€ community_agent.py        # Neighborhood analysis
â”‚   â”‚
â”‚   â”œâ”€â”€ clients/                      # External API clients
â”‚   â”‚   â”œâ”€â”€ brigthdata.py             # Bright Data scraping services
â”‚   â”‚   â”œâ”€â”€ firecrawl_mcp.py          # Firecrawl scraping services
â”‚   â”‚   â”œâ”€â”€ tavily.py                 # Tavily search API
â”‚   â”‚   â””â”€â”€ vapi.py                   # Low-level VAPI telephony API
â”‚   â”‚
â”‚   â””â”€â”€ utils/                        # Utility functions
â”‚       â”œâ”€â”€ scraper.py                # HTML parsing utilities
â”‚       â””â”€â”€ firecrawl_scraper.py      # Firecrawl integration helpers
â”‚
â”œâ”€â”€ frontend/                         # Next.js frontend
â”‚   â”œâ”€â”€ app/                          # Next.js app directory
â”‚   â”‚   â”œâ”€â”€ components/               # React components
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatInterface.tsx     # Main chat UI
â”‚   â”‚   â”‚   â”œâ”€â”€ MapView.tsx           # Interactive map display
â”‚   â”‚   â”‚   â”œâ”€â”€ PropertyCard.tsx      # Property listing cards
â”‚   â”‚   â”‚   â””â”€â”€ ...                   # Other UI components
â”‚   â”‚   â”œâ”€â”€ sections/                 # Page sections
â”‚   â”‚   â”œâ”€â”€ services/                 # API client services
â”‚   â”‚   â””â”€â”€ types/                    # TypeScript type definitions
â”‚   â”œâ”€â”€ package.json                  # Node.js dependencies
â”‚   â””â”€â”€ tsconfig.json                 # TypeScript configuration
â”‚
â”œâ”€â”€ tests/                            # Test suite
â”‚   â”œâ”€â”€ test_search_flow.py           # Integration tests
â”‚   â””â”€â”€ test_direct_vapi_call.py      # VAPI call tests
â”‚
â”œâ”€â”€ README.MD                         # This file
â”œâ”€â”€ PRD.MD                            # Product Requirements Document
â””â”€â”€ LICENSE                           # MIT License
```

---

## ğŸš€ Getting Started

### Prerequisites

- **Python 3.10+** - Backend runtime
- **Node.js 18+** - Frontend runtime
- **Active API Keys** for:
  - ASI or another LLM provider (`ASI_API_KEY`)
  - Bright Data (`BRIGHT_DATA_API_KEY`)
  - Firecrawl (`FIRECRAWL_API_KEY`)
  - VAPI (`VAPI_PRIVATE_API_KEY`, `VAPI_ASSISTANT_ID`, `VAPI_PHONE_NUMBER_ID`)
  - Mapbox (`MAPBOX_API_KEY`)

### Installation & Setup

#### 1. Clone the Repository

```bash
git clone <your-repo-url>
cd Algarve_Hack
```

#### 2. Backend Setup

```bash
# Navigate to backend directory
cd backend

# Install Python dependencies
pip install -r requirement.txt

# Create environment file
cp .env.example .env  # If exists, or create manually
```

#### 3. Configure Environment Variables

Create a `.env` file in the `backend/` directory:

```env
# LLM Configuration
ASI_API_KEY="sk-..."

# Web Scraping Services
BRIGHT_DATA_API_KEY="..."
FIRECRAWL_API_KEY="..."

# VAPI Telephony Service
VAPI_PRIVATE_API_KEY="..."
VAPI_ASSISTANT_ID="..."
VAPI_PHONE_NUMBER_ID="..."

# Mapping & Geocoding
MAPBOX_API_KEY="pk.eyJ..."

# Optional: Tavily Search
TAVILY_API_KEY="..."
```

#### 4. Frontend Setup

```bash
# Navigate to frontend directory
cd ../frontend

# Install Node.js dependencies
npm install

# Create environment file (if needed)
cp .env.example .env.local
```

#### 5. Run the Application

**Start the Backend (Agent Bureau):**

```bash
# From backend directory
python backend/main.py
```

The FastAPI server will be available at `http://localhost:8080`, with endpoints like:
- `/api/chat` - Main chat endpoint
- `/api/negotiate` - Negotiation workflow endpoint

**Start the Frontend:**

```bash
# From frontend directory
npm run dev
```

The Next.js app will be available at `http://localhost:3000`

---

## ğŸ”Œ API Endpoints

### Chat Endpoint

**POST** `/api/chat`

Initiates a conversation with the agent system.

```json
{
  "message": "Procuro um T2 em Faro atÃ© 1000â‚¬",
  "session_id": "unique-session-id"
}
```

**Response:**

```json
{
  "status": "success",
  "data": {
    "response": "Encontrei 15 propriedades que correspondem aos seus critÃ©rios...",
    "properties": [...],
    "session_id": "unique-session-id"
  }
}
```

### Negotiate Endpoint

**POST** `/api/negotiate`

Initiates automated negotiation calls for selected properties.

```json
{
  "address": "Rua da Universidade, Faro",
  "name": "JoÃ£o Silva",
  "email": "joao@example.com",
  "additional_info": "Interested in viewing",
  "listing_data": {
    "contact_phone": "+351912345678",
    "price": 950,
    "title": "T2 Apartment near University"
  }
}
```

**Response:**

```json
{
  "status": "success",
  "call_id": "vapi-call-id",
  "message": "Call initiated successfully"
}
```

---

## ğŸ§ª Testing

Run the test suite:

```bash
# From project root
cd tests
python -m pytest test_search_flow.py
python -m pytest test_direct_vapi_call.py
```

---

## ğŸ› ï¸ Technology Stack

### Backend
- **uAgents** - Multi-agent framework
- **FastAPI** - REST API framework
- **Pydantic** - Data validation and settings
- **Python 3.10+** - Runtime

### Frontend
- **Next.js 16** - React framework
- **TypeScript** - Type safety
- **Tailwind CSS** - Styling
- **React 19** - UI library

### External Services
- **Bright Data** - Web scraping infrastructure
- **Firecrawl** - Web scraping service
- **VAPI** - AI telephony platform
- **Mapbox** - Mapping and geocoding
- **Tavily** - Search API

---

## ğŸ“ˆ Performance & Scalability

- **Chat Response Time**: p95 < 3 seconds
- **Geocoding & POI**: Batch processing < 6 seconds
- **Scraping Rate**: â‰¤ 2 requests per second per domain
- **Concurrent Calls**: Asynchronous VAPI calls handle multiple properties simultaneously

---

## ğŸ”’ Security & Privacy

- **GDPR Compliant**: Explicit consent for data processing
- **Data Minimization**: Only necessary data collected
- **Secure Storage**: API keys stored in environment variables
- **Rate Limiting**: Respects source website ToS

---

## ğŸ¤ Contributing

Contributions are welcome! Please read our contributing guidelines before submitting pull requests.

---

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

## ğŸ™ Acknowledgments

- Portuguese real estate portals for providing listing data
- VAPI for AI telephony capabilities
- Mapbox for geospatial services
- The uAgents community

---

## ğŸ“ Support

For questions, issues, or feature requests, please open an issue on GitHub.

---

<div align="center">

**Built with â¤ï¸ for the Algarve housing community**

Made in Portugal ğŸ‡µğŸ‡¹

</div>

